test_cases:
    calendar_event_change_invitation_status_from_the_ui_works:
        title: |-
            Check invitiation status of the event is updated using AJAX controller in the UI.
        description: |-
            Create regular calendar event with 2 attendees and update invitation status of the events.
            It is expected the invitation status of main event and the child event can be updated.
        steps:
            -
                title: |-
                    Setup calendar connection to include calendar of attendee user.
                actions:
                    - @test_api_rest_post_calendar_connection:
                        auth:
                            username: foo_user_1
                            apiKey: foo_user_1_api_key
                        request:
                            content:
                                targetCalendar: "reference('oro_calendar:calendar:foo_user_1').getId()"
                                calendar: "reference('oro_calendar:calendar:foo_user_2').getId()"
                                calendarAlias: "user"
                                visible: true
                        response:
                            statusCode: 201
                            contentType: application/json
                            content:
                                id: "path('id')"
            -
                title: |-
                    Create new calendar event with attendee related to user with different calendar.
                actions:
                    - @test_api_rest_post_calendar_event:
                        auth:
                            username: foo_user_1
                            apiKey: foo_user_1_api_key
                        request:
                            content:
                                title: "Regular event"
                                start: "2016-10-14T22:00:00+00:00"
                                end: "2016-10-14T23:00:00+00:00"
                                calendar: "reference('oro_calendar:calendar:foo_user_1').getId()"
                                attendees:
                                    -
                                        displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                        email: "foo_user_1@example.com"
                                        status: "none"
                                    -
                                        displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                        email: "foo_user_2@example.com"
                                        status: "none"
                        response:
                            statusCode: 201
                            contentType: application/json
                            content:
                                id: "path('id')"
                                notifiable: true
                                invitationStatus: "none"
                            strictCompare: true
                        entityReference: "new_calendar_event"
                        referenceToChildEventOwnerMapping:
                            "child_event": "reference('oro_calendar:user:foo_user_2')"
            -
                title: |-
                    Get the events and verify the invitation status is set to "none" in both events.
                actions:
                    - @test_api_rest_get_calendar_events:
                        auth:
                            username: foo_user_1
                            apiKey: foo_user_1_api_key
                        request:
                            parameters:
                                calendar: "reference('oro_calendar:calendar:foo_user_1').getId()"
                                start: "2016-10-01T00:00:00+00:00"
                                end: "2016-10-31T00:00:00+00:00"
                                subordinate: true
                        response:
                            statusCode: 200
                            contentType: application/json
                            content:
                                -
                                    id: "reference('new_calendar_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_1').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "none"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "none"
                                            type: "required"
                                    notifiable: true
                                    invitationStatus: "none"
                                -
                                    id: "reference('child_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_2').getId()"
                                    parentEventId: "reference('new_calendar_event').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "none"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "none"
                                            type: "required"
                                    notifiable: false
                                    invitationStatus: "none"
            -
                title: |-
                    Update invitation status of the main event to "accepted".
                actions:
                    - @test_api_rest_get:
                        request:
                            route: 'oro_calendar_event_accepted'
                            parameters:
                                id: "reference('new_calendar_event').getId()"
                        response:
                            statusCode: 200
                            contentType: application/json
                            content:
                                successful: true
                            strictCompare: true
            -
                title: |-
                    Get the events and verify the invitation status is set to "accepted" in the main event
                    and "none" in the child event.
                actions:
                    - @test_api_rest_get_calendar_events:
                        auth:
                            username: foo_user_1
                            apiKey: foo_user_1_api_key
                        request:
                            parameters:
                                calendar: "reference('oro_calendar:calendar:foo_user_1').getId()"
                                start: "2016-10-01T00:00:00+00:00"
                                end: "2016-10-31T00:00:00+00:00"
                                subordinate: true
                        response:
                            statusCode: 200
                            contentType: application/json
                            content:
                                -
                                    id: "reference('new_calendar_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_1').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "accepted"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "none"
                                            type: "required"
                                    notifiable: true
                                    invitationStatus: "accepted"
                                -
                                    id: "reference('child_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_2').getId()"
                                    parentEventId: "reference('new_calendar_event').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "accepted"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "none"
                                            type: "required"
                                    notifiable: false
                                    invitationStatus: "none"
            -
                title: |-
                    Update invitation status of the main event to "tentative".
                actions:
                    - @test_api_rest_get:
                        request:
                            route: 'oro_calendar_event_tentative'
                            parameters:
                                id: "reference('new_calendar_event').getId()"
                        response:
                            statusCode: 200
                            contentType: application/json
                            content:
                                successful: true
                            strictCompare: true
            -
                title: |-
                    Get the events and verify the invitation status is set to "tentative" in the main event
                    and "none" in the child event.
                actions:
                    - @test_api_rest_get_calendar_events:
                        auth:
                            username: foo_user_1
                            apiKey: foo_user_1_api_key
                        request:
                            parameters:
                                calendar: "reference('oro_calendar:calendar:foo_user_1').getId()"
                                start: "2016-10-01T00:00:00+00:00"
                                end: "2016-10-31T00:00:00+00:00"
                                subordinate: true
                        response:
                            statusCode: 200
                            contentType: application/json
                            content:
                                -
                                    id: "reference('new_calendar_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_1').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "tentative"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "none"
                                            type: "required"
                                    notifiable: true
                                    invitationStatus: "tentative"
                                -
                                    id: "reference('child_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_2').getId()"
                                    parentEventId: "reference('new_calendar_event').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "tentative"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "none"
                                            type: "required"
                                    notifiable: false
                                    invitationStatus: "none"
            -
                title: |-
                    Update invitation status of the main event to "declined".
                actions:
                    - @test_api_rest_get:
                        request:
                            route: 'oro_calendar_event_declined'
                            parameters:
                                id: "reference('new_calendar_event').getId()"
                        response:
                            statusCode: 200
                            contentType: application/json
                            content:
                                successful: true
                            strictCompare: true
            -
                title: |-
                    Get the events and verify the invitation status is set to "declined" in the main event
                    and "none" in the child event.
                actions:
                    - @test_api_rest_get_calendar_events:
                        auth:
                            username: foo_user_1
                            apiKey: foo_user_1_api_key
                        request:
                            parameters:
                                calendar: "reference('oro_calendar:calendar:foo_user_1').getId()"
                                start: "2016-10-01T00:00:00+00:00"
                                end: "2016-10-31T00:00:00+00:00"
                                subordinate: true
                        response:
                            statusCode: 200
                            contentType: application/json
                            content:
                                -
                                    id: "reference('new_calendar_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_1').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "declined"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "none"
                                            type: "required"
                                    notifiable: true
                                    invitationStatus: "declined"
                                -
                                    id: "reference('child_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_2').getId()"
                                    parentEventId: "reference('new_calendar_event').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "declined"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "none"
                                            type: "required"
                                    notifiable: false
                                    invitationStatus: "none"
            -
                title: |-
                    Update invitation status of the child event to "accepted".
                actions:
                    - @test_api_rest_get:
                        request:
                            route: 'oro_calendar_event_accepted'
                            parameters:
                                id: "reference('child_event').getId()"
                        response:
                            statusCode: 200
                            contentType: application/json
                            content:
                                successful: true
                            strictCompare: true
            -
                title: |-
                    Get the events and verify the invitation status is set to "declined" in the main event
                    and "accepted" in the child event.
                actions:
                    - @test_api_rest_get_calendar_events:
                        auth:
                            username: foo_user_1
                            apiKey: foo_user_1_api_key
                        request:
                            parameters:
                                calendar: "reference('oro_calendar:calendar:foo_user_1').getId()"
                                start: "2016-10-01T00:00:00+00:00"
                                end: "2016-10-31T00:00:00+00:00"
                                subordinate: true
                        response:
                            statusCode: 200
                            contentType: application/json
                            content:
                                -
                                    id: "reference('new_calendar_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_1').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "declined"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "accepted"
                                            type: "required"
                                    notifiable: true
                                    invitationStatus: "declined"
                                -
                                    id: "reference('child_event').getId()"
                                    calendar:  "reference('oro_calendar:calendar:foo_user_2').getId()"
                                    parentEventId: "reference('new_calendar_event').getId()"
                                    attendees:
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_1').getFullName()"
                                            email: "foo_user_1@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_1').getId()"
                                            status: "declined"
                                            type: "required"
                                        -
                                            displayName: "reference('oro_calendar:user:foo_user_2').getFullName()"
                                            email: "foo_user_2@example.com"
                                            userId: "reference('oro_calendar:user:foo_user_2').getId()"
                                            status: "accepted"
                                            type: "required"
                                    notifiable: false
                                    invitationStatus: "accepted"
